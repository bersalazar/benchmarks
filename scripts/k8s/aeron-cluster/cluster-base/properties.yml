---
apiVersion: v1
kind: ConfigMap
metadata:
  name: aeron-benchmark-envs
data:
  TEST_OUTPUT_PATH: /dev/shm/results
  BENCHMARKS_PATH: /opt/aeron-benchmarks
  BENCHMARK_PRE_SLEEP: '20'  # seconds to wait before starting the benchmark
  NODE0_ADDRESS: aeron-cluster-0.aeron-cluster
  NODE1_ADDRESS: aeron-cluster-1.aeron-cluster
  NODE2_ADDRESS: aeron-cluster-2.aeron-cluster
  CLIENT0_ADDRESS: aeron-cluster-client
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: aeron-benchmark-dpdk
data:
  AERON_DPDK_THREADS_FROM_CGROUP: 'TRUE'
  AERON_DPDK_TX_MEMPOOL_PER_QUEUE: 'true'
  AERON_DPDK_TX_MEMPOOL_OPS: ring_mp_mc
  AERON_DPDK_TX_MEMPOOL_CACHE_SIZE: '512'
  AERON_DPDK_RX_MEMPOOL_OPS: ring_mp_mc
  AERON_DPDK_RX_MEMPOOL_CACHE_SIZE: '512'
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: aeron-benchmark-properties
data:
  cluster.properties: |
    aeron.cluster.members=0,aeron-cluster-0.aeron-cluster:20000,aeron-cluster-0.aeron-cluster:20001,aeron-cluster-0.aeron-cluster:20002,aeron-cluster-0.aeron-cluster:20003,aeron-cluster-0.aeron-cluster:20004|\
    1,aeron-cluster-1.aeron-cluster:20000,aeron-cluster-1.aeron-cluster:20001,aeron-cluster-1.aeron-cluster:20002,aeron-cluster-1.aeron-cluster:20003,aeron-cluster-1.aeron-cluster:20004|\
    2,aeron-cluster-2.aeron-cluster:20000,aeron-cluster-2.aeron-cluster:20001,aeron-cluster-2.aeron-cluster:20002,aeron-cluster-2.aeron-cluster:20003,aeron-cluster-2.aeron-cluster:20004

    aeron.cluster.ingress.channel=aeron:udp
    aeron.archive.recording.events.enabled=false

    # Reduce window sizes when running locally to prevent excessive memory usage.
    # Remove these options when running in a production-like environment.
    # aeron.term.buffer.sparse.file=true
    # aeron.pre.touch.mapped.memory=false
    # aeron.socket.so_sndbuf=128k
    # aeron.socket.so_rcvbuf=128k
    # aeron.rcv.initial.window.length=128k
    # aeron.term.buffer.length=128k
    # aeron.ipc.term.buffer.length=128k

    # Uncomment to enable latency test history tracking.
    # io.aeron.benchmarks.track.history=true
    # io.aeron.benchmarks.cluster.snapshot.size=0
    # io.aeron.benchmarks.message.transceiver=remote.aeron.io.aeron.benchmarks.ClusterMessageTransceiver
    # io.aeron.benchmarks.iterations=1000

    # additionally added for setting up tests in k8s
    io.aeron.benchmarks.output.directory=/dev/shm/results
  node.properties: |
    aeron.dir=/dev/shm/aeron
    aeron.cluster.dir=/aeron-data/cluster
    aeron.archive.dir=/aeron-data/archive
  benchmark.properties: |
    io.aeron.benchmarks.message.rate=100
    io.aeron.benchmarks.output.file=bench_out.txt
    io.aeron.benchmarks.output.directory=/dev/shm/results
    aeron.cluster.ingress.channel=aeron:udp
    aeron.cluster.ingress.endpoints=0=aeron-cluster-0.aeron-cluster:20000,1=aeron-cluster-1.aeron-cluster:20000,2=aeron-cluster-2.aeron-cluster:20000
  low-latency-driver.properties: |
    aeron.conductor.idle.strategy=noop
    aeron.dir.delete.on.shutdown=true
    aeron.dir.delete.on.start=true
    aeron.dir=/dev/shm/aeron
    aeron.driver.timeout=30000
    aeron.perform.storage.checks=false
    aeron.pre.touch.mapped.memory=false
    aeron.print.configuration=true
    aeron.rcv.initial.window.length=2m
    aeron.receiver.idle.strategy=noop
    aeron.sender.idle.strategy=noop
    aeron.socket.so_rcvbuf=2m
    aeron.socket.so_sndbuf=2m
    aeron.spies.simulate.connection=true
    aeron.term.buffer.sparse.file=true
    aeron.threading.mode=DEDICATED
    aeron.use.windows.high.res.timer=true
    agrona.disable.bounds.checks=true

    aeron.ipc.mtu.length=8k
    aeron.mtu.length=8k
    aeron.network.publication.max.messages.per.send=2
    aeron.receiver.io.vector.capacity=2
    aeron.sender.io.vector.capacity=2
